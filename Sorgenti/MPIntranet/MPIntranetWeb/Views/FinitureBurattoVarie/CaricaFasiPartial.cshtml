@using MPIntranet.Models.Finiture_Burattovarie
@model List<FasiModel>

@if (Model != null && Model.Count() == 0)
{
    <text><b>Nessun risultato trovato</b></text>
}
else
{
    <table id="grigliaFasi" class="table table-condensed table-hover">
        <thead style="background-color:aliceblue">
            <tr>
                <th>Codice</th>
                <th>Descrizione</th>
                <th>Ricarico</th>
                <th>CostoOrario</th>
                <th></th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @foreach (FasiModel td in Model)
            {
                <tr>
                    <td width="20%">
                        @td.Codice                       
                    </td>
                    <td width="20%">
                        @Html.TextBox("txtDescrizioneS", td.Descrizione, new { @class = "form-control input-sm", @id = "txtDescrizioneS", @maxlength = "30" })
                    </td>
                    <td width="20%">
                        @Html.TextBox("txtRicaricoS", td.Ricarico, new { @class = "form-control input-sm", @id = "txtRicaricoS" })
                    </td>
                    <td width="20%">
                        @Html.TextBox("txtCostoOrarioS", td.CostoOrario, new { @class = "form-control input-sm", @id = "txtCostoOrarioS" })
                    </td>

                    <td align="right">
                        @if ((ViewData["MenuAbilitati"] as List<decimal>).Contains(333))
                        {
                            <a onclick="ModificaFasi(this,@td.IdFbvFasi)" title="Modifica"><i class="fa fa-fw fa-pencil"></i></a>
                        }
                    </td>
                    <td align="right">
                        @if ((ViewData["MenuAbilitati"] as List<decimal>).Contains(332))
                        {
                            <a onclick="CancellaFasi(@td.IdFbvFasi)" title="Cancella"><i class="fa fa-fw fa-remove"></i></a>
                        }
                    </td>

                </tr>

            }
        </tbody>
    </table>
    <div class="col-lg-12 row">
        <div class="col-lg-2 text-center">
            <label id="faseSelezionata"></label>
            <input type="hidden" id="hfFase" />
        </div>
    </div>
    <div class="col-md-12" id="divProprieta"></div>
}
<script language="javascript" type="text/javascript">

    $(function () {
        $("#grigliaFasi tr").click(function () {
            debugger;
            var tds = $(this).find('td');
            var codiceFase = tds[0].innerText;
            $('#hfFase').val(codiceFase);
            caricaProprieta(); 
        });

        
      
    });

    function caricaProprieta()
    {
        var codiceFase = $('#hfFase').val();
        if (codiceFase == null || codiceFase == '') {
            return;
        }
        var url = '@Url.Action("CaricaProprieta", "FinitureBurattovarie")';
        $.ajax({

//            select fp.*, pr.codice, pr.descrizione from fbvfasiproprieta fp
//inner join fbvfasi fa on fa.idfbvfase = fp.idfbvfase
//inner join fbvproprieta pr on pr.idfbvproprieta = fp.idfbvproprieta
//where fa.codice = 'BAU'

        url: url,
            data:
            {
            }, 
            cache: false,
            type: "POST",
            success: function(data)
            {
                $('#divProprieta').html(data).show();
            },
            error: function(response)
            {
                document.open();
                document.write(response.responseText);
                document.close();
            }
        });
    }
</script>
                    

